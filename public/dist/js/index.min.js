"use strict";var formatter=new Intl.NumberFormat("zh-TW",{style:"currency",currency:"NTD",minimumFractionDigits:0});function init(){var d=document.querySelector(".check"),t=document.querySelector(".check .container"),o=document.querySelector(".container__head"),i=document.querySelector(".container__body"),s=document.querySelector(".container__foot"),l=document.querySelector(".cart"),u=document.querySelector(".count"),e=document.querySelector(".products");function m(){0<localStorage.number?u.classList.remove("hide"):(u.classList.add("hide"),localStorage.setItem("number",0)),u.innerText=localStorage.number}function n(){var e,t,n=localStorage,r=[];for(e in n)!1===isNaN(Number(e))&&((t={}).id=e,t.quantity=n[e],r.push(t));fetch("/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(function(e){return e.json()}).then(function(e){0<localStorage.number&&function(e){var r='\n      <div></div>\n      <div class="title">名&nbsp;&nbsp;稱</div>\n      <div class="price">價&nbsp;&nbsp;格</div>\n      <div class="quantity">數&nbsp;&nbsp;量</div>\n      <div class="amount">金&nbsp;&nbsp;額</div>\n      ',a=0,c=0;o.innerHTML="",i.innerHTML="",s.innerHTML="";var t=document.createElement("div");t.classList.add("row"),t.classList.add("head"),t.innerHTML=r,o.appendChild(t),e.forEach(function(e){var t=document.createElement("div"),n=r.replace("<div></div>",'<button class="delete">刪除</button>').replace("名&nbsp;&nbsp;稱",e.title).replace("價&nbsp;&nbsp;格",formatter.format(e.price)).replace("數&nbsp;&nbsp;量","".concat(e.quantity," 份")).replace("金&nbsp;&nbsp;額",formatter.format(e.price*e.quantity));c+=e.price*e.quantity,a+=Number(e.quantity),t.classList.add("row"),t.classList.add("body"),t.setAttribute("data-id",e.id),t.innerHTML=n,i.appendChild(t)}),t=document.createElement("div"),e=r.replace("名&nbsp;&nbsp;稱","總&nbsp;&nbsp;&nbsp;計：").replace("價&nbsp;&nbsp;格","").replace("數&nbsp;&nbsp;量","共  ".concat(a," 份")).replace("金&nbsp;&nbsp;額",formatter.format(c)),t.classList.add("row"),t.classList.add("foot"),t.innerHTML=e,s.appendChild(t),d.classList.remove("hide"),document.querySelector(".cart").classList.add("hide")}(e)}).catch(function(e){return console.log(e)})}m(),document.addEventListener("click",function(e){(e=e.target)===d&&e!==t&&(d.classList.add("hide"),l.classList.remove("hide"))}),document.querySelector(".cart").addEventListener("click",n),document.querySelector(".clear").addEventListener("click",function(){localStorage.clear(),d.classList.add("hide"),l.classList.remove("hide"),u.classList.add("hide"),m()}),document.querySelector(".back__menu").addEventListener("click",function(){d.classList.add("hide"),l.classList.remove("hide")}),document.querySelector(".check .container").addEventListener("click",function(e){var t,n,r,a,c,o,i;"delete"===(t=e.target).className&&(n=t.parentNode.getAttribute("data-id"),r=document.querySelector(".foot .quantity").innerText.match(/\d+/g).map(Number)[0],a=localStorage["".concat(n)],c=document.querySelector(".foot .amount").innerText.match(/\d/g).map(Number),e=t.parentNode.querySelector(".amount").innerText.match(/\d/g).map(Number),i=o="",c.forEach(function(e){o+=e}),e.forEach(function(e){i+=e}),document.querySelector(".foot .quantity").innerText="共 ".concat(Number(r)-Number(a)," 份"),document.querySelector(".foot .amount").innerText=formatter.format(Number(o)-Number(i)),u.innerText=localStorage.number,t.parentNode.parentNode.removeChild(t.parentNode),localStorage.removeItem(n),localStorage.number-=Number(a),0===Number(localStorage.number)&&(l.classList.remove("hide"),d.classList.add("hide")),m())}),document.querySelector(".cart").addEventListener("click",n),e&&e.addEventListener("click",function(e){"add-cart__btn"===(e=e.target).className&&(e=e.parentNode.parentNode.querySelector(".id").innerText,localStorage.number<99&&localStorage.setItem("number",Number(localStorage.number)+1),u.innerText=localStorage.number,u.classList.remove("hide"),localStorage["".concat(e)]?localStorage.setItem(e,Number(localStorage["".concat(e)])+1):localStorage.setItem(e,1))})}document.addEventListener("DOMContentLoaded",function(){init();new LazyLoad({})});